@page
@model ProjectQ.Pages.FinancialsModel

<div style="height: 100vh; display: flex; flex-direction: column; gap: 12px;">
    <!-- 🔼 TOP HALF: CHARTS -->
    <div style="flex: 1; display: flex; justify-content: space-around; align-items: center; padding: 12px;">
        <div style="width: 45%;">
            <h5 class="text-center">AAPL Revenue by Year</h5>
            <canvas id="revenueChart"></canvas>
        </div>
        <div style="width: 45%;">
            <h5 class="text-center">AAPL EPS by Year</h5>
            <canvas id="epsChart"></canvas>
        </div>
    </div>

    <!-- 🔽 BOTTOM HALF: EXISTING TABLE -->
    <div style="flex: 1; overflow-y: auto;">
        <h4 class="mb-2">Yahoo Finance Financials</h4>
        <p>
            <a asp-page="/Add" class="btn btn-outline-secondary btn-sm">
                ➕ Add New Record
            </a>
        </p>

        <table class="table table-bordered table-sm">
            <thead>
                <tr>
                    <th>Ticker</th>
                    <th>Company</th>
                    <th>Time Period</th>
                    <th>Revenue</th>
                    <th>EPS</th>
                    <th>EBIT</th>
                    <th>EBITDA</th>
                    <th>Gross Profit</th>
                    <th>Date Added</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model.Records)
                {
                    <tr>
                        <td>@item.Ticker</td>
                        <td>@item.CompanyName</td>
                        <td>@item.TimePeriod</td>
                        <td>@item.Revenue</td>
                        <td>@item.EPS</td>
                        <td>@item.EBIT</td>
                        <td>@item.EBITDA</td>
                        <td>@item.GrossProfit</td>
                        <td>@item.Date.ToString("yyyy-MM-dd")</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // 📈 AAPL Revenue
        new Chart(document.getElementById('revenueChart'), {
            type: 'bar',
            data: {
                labels: ['2024', '2025', '2026'],
                datasets: [{
                    label: 'Revenue (USD)',
                    data: [391035000000, 400366000000, 431010000000],
                    backgroundColor: '#4e79a7'
                }]
            },
            options: {
                scales: {
                    y: {
                        ticks: {
                            callback: value => '$' + (value / 1e9).toFixed(0) + 'B'
                        }
                    }
                }
            }
        });

        // 📉 AAPL EPS
        new Chart(document.getElementById('epsChart'), {
            type: 'line',
            data: {
                labels: ['2024', '2025', '2026'],
                datasets: [{
                    label: 'EPS',
                    data: [6.11, 6.45, 7.17],
                    borderColor: '#e15759',
                    fill: false
                }]
            }
        });
    </script>
}
